<!DOCTYPE html>
<html>
  <head>
    <title>BCIVr</title>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css"/>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato"/>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"/>

    <script src="/socket.io/socket.io.js"></script>

    <link href="https://cdnjs.cloudflare.com/ajax/libs/rangeslider.js/2.3.1/rangeslider.css" rel="stylesheet" type="text/css"/>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>


    <style>
    body,h1,h2,h3,h4,h5,h6 {font-family: "Lato", sans-serif}
    .w3-bar,h1,button {font-family: "Montserrat", sans-serif}
    .fa-anchor,.fa-coffee {font-size:200px}
    </style>

    <script>
      //socket = io('http://184.97.234.68');
      var socket = io('http://192.168.0.6').connect();
    </script>

  </head>

  <body>

    <header class="w3-container w3-red w3-center" style="padding:128px 16px">
      <h1 class="w3-margin w3-jumbo">Panguin House</h1>
      <input class="w3-button w3-black w3-padding-large w3-large w3-margin-top" type="button" onclick="location.href='html/MultiNetPage.html';" value="VR" />
      <input class="w3-button w3-black w3-padding-large w3-large w3-margin-top" type="button" onclick="location.href='html/VRtest.html';" value="VRtestbed" />
      <input class="w3-button w3-black w3-padding-large w3-large w3-margin-top" type="button" onclick="location.href='html/ARexamp.html';" value="AR" />
      <input class="w3-button w3-black w3-padding-large w3-large w3-margin-top" type="button" onclick="location.href='html/loader.html';" value="stl viewer" />
    </header>

    <header class="w3-container w3-white w3-center" style="padding:-64px 100px">
      <div class = "w3-middle w3-right" style="padding:0px 400px 0px 0px">
        <input class="w3-button w3-black w3-large w3-margin-top" type="button" onclick="UserAction()"value="Get Home Status"/>
        <p id="energy_totalStatus">Total energy:</p>
        <p id="energy_miner1Status">Miner1</p>
        <p id="energy_miner2Status">Miner2</p>
        <p id="energy_solarStatus">Solar</p>
        <p id="hashrateStatus">Hashrate</p>
      </div>
      <div class="w3-left">
        <iframe width="700" height="400"
          src="https://video.nest.com/embedded/live/O76Xxo82vh?autoplay=0" allowfullscreen>
        </iframe>
      </div>

      <div class = "w3-right w3-top" style="padding: 0px 100px 0px 0px">
        <h3>Lightbulbs</h3>
      </div>

    </header>

    <div class="w3-display-container w3-black w3-opacity w3-padding-64">
      <div class = "w3-display-topmiddle">
        <h3>Lightbulbs</h3>
      </div>

      <div style="padding:0px 100px">
        <text class="w3-black">Bookcase</text>
        <input type="range" min="-0" max="254" value="-10" id="Slider1">
        <output1></output1>
      </div>

      <div style="padding:0px 500px">
        <text class="w3-black">Computer</text>
        <input type="range" min="-0" max="254" value="-10" id="Slider2">
        <output2></output2>
      </div>
    </div>

    <script>
      function UserAction(){
        socket.emit('send message');
        socket.on('new message', function(data1,data2,data3, data4, data5){
          document.getElementById("energy_totalStatus").innerHTML = ("Current energy usage is: " + data1 + " Watts");
          document.getElementById("energy_miner1Status").innerHTML = ("Miner1 is using: " + data2 + " Watts");
          document.getElementById("energy_miner2Status").innerHTML = ("Miner2 is using: " + -1*data3 + " Watts");
          document.getElementById("energy_solarStatus").innerHTML = ("Currently generating: " + -1*data4 + " Watts");
          document.getElementById("hashrateStatus").innerHTML = ("Current hashrate is: " + data5.total_hashrate_calculated + " MH/s");
        });
      };
    </script>

    <script>
    $(function() {
        var $document = $(document);
        var selector = '[data-rangeslider]';
        var $element = $(selector);
        // For ie8 support
        var textContent = ('textContent' in document) ? 'textContent' : 'innerText';
        // Example functionality to demonstrate a value feedback
        function valueOutput(id, element) {
            var value = element.value;
            if(id=="Slider1"){
              var output1 = element.parentNode.getElementsByTagName('output1')[0] || element.parentNode.parentNode.getElementsByTagName('output1')[0];
              output1[textContent] = value;
              state = 1;
              socket.emit('lightbulb',{value, state});
            }
            else if (id=="Slider2") {
              var output2 = element.parentNode.getElementsByTagName('output2')[0] || element.parentNode.parentNode.getElementsByTagName('output2')[0];
              output2[textContent] = value;
              state = 2;
              socket.emit('lightbulb',{value, state});
            }

        }
        $document.on('input', 'input[type="range"], ' + selector, function(e) {
          console.log(e.target.id);
            valueOutput(e.target.id, e.target);
        });


    });
    </script>

  </body>
</html>
